<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Estad칤sticas de Asistencia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 font-sans p-6">

    <nav class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-800">游늵 An치lisis de Asistencia</h1>
            <p class="text-gray-500">Reporte de incidencias y puntualidad escolar</p>
        </div>
        <a href="/dashboard" class="bg-gray-700 text-white px-4 py-2 rounded hover:bg-gray-600">Volver al Dashboard</a>
    </nav>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
        
        <div class="bg-white p-6 rounded-xl shadow-lg">
            <h2 class="font-bold text-gray-700 mb-4 border-b pb-2">Panorama General de la Escuela</h2>
            <div class="h-64 flex justify-center">
                <canvas id="graficaGlobal"></canvas>
            </div>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-lg">
            <h2 class="font-bold text-gray-700 mb-4 border-b pb-2">Grupos con Mayor Ausentismo</h2>
            <div class="h-64">
                <canvas id="graficaGrupos"></canvas>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        
        <div class="bg-white rounded-xl shadow-lg overflow-hidden border-t-4 border-red-500">
            <div class="p-4 bg-red-50 flex items-center gap-2">
                <span class="material-icons text-red-500">warning</span>
                <h3 class="font-bold text-red-800">Alumnos con m치s FALTAS</h3>
            </div>
            <table class="w-full text-left">
                <thead class="bg-red-100 text-red-900 text-xs uppercase">
                    <tr>
                        <th class="p-3">Alumno</th>
                        <th class="p-3">Grupo</th>
                        <th class="p-3 text-center">Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for alumno in top_faltas %}
                    <tr class="border-b hover:bg-red-50">
                        <td class="p-3 font-medium">{{ alumno.nombre_completo }}</td>
                        <td class="p-3 text-sm text-gray-500">{{ alumno.grupo }}</td>
                        <td class="p-3 text-center font-bold text-red-600 text-lg">{{ alumno.cantidad }}</td>
                    </tr>
                    {% else %}
                    <tr><td colspan="3" class="p-4 text-center text-gray-400">Sin faltas registradas</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="bg-white rounded-xl shadow-lg overflow-hidden border-t-4 border-yellow-500">
            <div class="p-4 bg-yellow-50 flex items-center gap-2">
                <span class="material-icons text-yellow-600">schedule</span>
                <h3 class="font-bold text-yellow-800">Alumnos con m치s RETARDOS</h3>
            </div>
            <table class="w-full text-left">
                <thead class="bg-yellow-100 text-yellow-900 text-xs uppercase">
                    <tr>
                        <th class="p-3">Alumno</th>
                        <th class="p-3">Grupo</th>
                        <th class="p-3 text-center">Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for alumno in top_retardos %}
                    <tr class="border-b hover:bg-yellow-50">
                        <td class="p-3 font-medium">{{ alumno.nombre_completo }}</td>
                        <td class="p-3 text-sm text-gray-500">{{ alumno.grupo }}</td>
                        <td class="p-3 text-center font-bold text-yellow-600 text-lg">{{ alumno.cantidad }}</td>
                    </tr>
                    {% else %}
                    <tr><td colspan="3" class="p-4 text-center text-gray-400">Sin retardos registrados</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>

<script>
    // 1. Configuraci칩n Gr치fica Global (Pastel)
    const ctxGlobal = document.getElementById('graficaGlobal').getContext('2d');
    
    // Verificamos si hay datos antes de dibujar para evitar errores vac칤os
    const datosGlobales = {{ data_global | tojson }};
    const etiquetasGlobales = {{ labels_global | tojson }};

    new Chart(ctxGlobal, {
        type: 'doughnut', 
        data: {
            labels: etiquetasGlobales, 
            datasets: [{
                data: datosGlobales,
                backgroundColor: ['#10B981', '#F59E0B', '#EF4444', '#3B82F6'], 
                hoverOffset: 4
            }]
        }
    });

    // 2. Configuraci칩n Gr치fica Grupos (Barras)
    const ctxGrupos = document.getElementById('graficaGrupos').getContext('2d');
    
    const datosGrupos = {{ data_grupo | tojson }};
    const etiquetasGrupos = {{ labels_grupo | tojson }};

    new Chart(ctxGrupos, {
        type: 'bar',
        data: {
            labels: etiquetasGrupos,
            datasets: [{
                label: 'Cantidad de Faltas',
                data: datosGrupos,
                backgroundColor: '#EF4444', // Rojo
                borderRadius: 5
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>
</body>
</html>